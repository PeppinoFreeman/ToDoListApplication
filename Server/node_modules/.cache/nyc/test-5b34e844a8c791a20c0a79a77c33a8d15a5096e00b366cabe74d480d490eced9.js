process.env.NODE_ENV = "test";

const chai = require("chai"),
  chaiHttp = require("chai-http"),
  request = require("supertest"),
  server = require("../server").app,
  routes = require("../lib/routes").Routes;
const mongoose = require("mongoose");
const Category = require("../lib/Schema").Categories;

const bodyParser = require("body-parser");
server.use(bodyParser.urlencoded({ extended: false }));
server.use(bodyParser.json());

chai.should();
chai.use(chaiHttp);

describe("Requêtes", () => {
  /*
  beforeEach(() => {
    return mongoose.connect("mongodb://localhost/ToDoDatabase", {
      useNewUrlParser: true,
      useUnifiedTopology: true,
      useFindAndModify: false,
    });
  });
  */
  it("Ajoute une catégorie", (done) => {
    request(server)
      .post(routes.category,)
      .then(
        send({category:'House'});
        done();
      )
      .end((err, res) => {
        res.should.have.status(200);
        res.body.should.be.a("object");
        console.log(res.body);
        done();
      });
  });
  it("Récupère la liste des catégories", (done) => {
    request(server)
      .get(routes.category)
      .end((err, res) => {
        res.should.have.status(200);
        res.body.should.be.a("array");
        console.log(res.body);
        done();
      });
  });
});
